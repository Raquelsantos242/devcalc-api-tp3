name: Monitoramento de falhas

permissions:
  issues: write

on:
  workflow_dispatch:

jobs:
  create-issue-if-failure:
    runs-on: windows-latest

    steps:
      - name: Simular falha de deploy
        run: exit 1

      - name: Criar issue se falha ocorreu
        if: ${{ failure() }}
        run: |
          curl -X POST https://api.github.com/repos/${{ github.repository }}/issues `
            -H "Authorization: Bearer ${{ github.token }}" `
            -H "Accept: application/vnd.github.v3+json" `
            -d '{ 
              "title": "Falha no deploy",
              "body": "O deploy autom√°tico falhou. Verifique os logs do workflow.",
              "labels": ["bug", "auto-created"]
            }'
        shell: pwsh
