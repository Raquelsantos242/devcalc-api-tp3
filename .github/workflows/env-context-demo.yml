name: Issue on Failure (Simple)

permissions:
  issues: write

on:
  workflow_dispatch:

jobs:
  create-issue-if-failure:
    runs-on: ubuntu-latest

    steps:
      - name: Simular falha de deploy
        run: exit 1 || true

      - name: Criar issue se falha ocorreu
        if: ${{ failure() }}
        run: |
          curl -X POST https://api.github.com/repos/${{ github.repository }}/issues \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -d '{
              "title": "falha no deploy",
              "body": "O deploy autom√°tico falhou. Verifique os logs do workflow.",
              "labels": ["bug", "auto-created"]
            }'
